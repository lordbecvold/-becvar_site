{% extends 'common/bases/admin-base.html.twig' %}

{% block title %}
    database
{% endblock %}

{% block component %}
<div class="admin-panel">
    {% if user_role != 'owner' %}
        <h2 class="page-title">Sorry you dont have permission to this page</h2>
    {% else %}
        {#=================================== TABLES-LIST ==================================#}
        {% if tables != null %}
            <h2 class="page-title">Select table</h2>
            <br>
            {% for table in tables %}
                <a class='db-browser-select-link' href="/admin/database/{{table}}/1">{{table}}</a>
                <br><br>
            {% endfor %}
        {% else %}
            {#=================================== ROW-EDITOR ===================================#}
            {% if editor_table != null %}
            <ul class="breadcrumb">
                <li>
                    <a class="selector-button btn-small" href="/admin/database/{{editor_table}}/{{editor_page}}"><strong><i class="fa fa-arrow-left" aria-hidden="true"></i></strong></a>
                </li>
                <li class="count-text-in-menuR">Row editor</li>
            </ul>
            {% if editor_error_msg != null %}
                <center>
                    <div class="alert alert-danger alert-dismissible fade show" role="alert">
                        <strong>Error</strong>: {{ editor_error_msg }}
                        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                </center>
            {% endif %}
            <center>
                <form class="db-edit-form dark-table" action="/admin/database/edit/{{editor_page}}/{{editor_table}}/{{editor_id}}" method="post">
                    <p class="title">Edit {{editor_table}}, row: {{editor_id}}<p></p>
                    {% for field in editor_field %}
                        {% if field != 'id' %}
                            <p class="text-input-title">{{field}}</p>
                            <input class="text-input" type="text" name="{{field}}" value="{{editor_values[field]}}"><br>
                        {% endif %}
                    {% endfor %}
                    <input class="input-button" type="submit" name="submitEdit" value="Edit">
                </form>
            </center>
            {% else %}
                {% if new_row_table != null %}
                    <ul class="breadcrumb">
                        <li>
                            <a class="selector-button btn-small" href="/admin/database/{{new_row_table}}/{{new_row_page}}"><strong><i class="fa fa-arrow-left" aria-hidden="true"></i></strong></a>
                        </li>
                        <li class="count-text-in-menuR">New row</li>
                    </ul>
                    {% if new_row_error != null %}
                        <center>
                            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                                <strong>Error</strong>: {{ new_row_error }}
                                <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                        </center>
                    {% endif %}
                    <center>
                        <form class="db-edit-form dark-table" action="/admin/database/add/{{new_row_page}}/{{new_row_table}}" method="post">
                            <p class="title">Add new: {{new_row_table}}<p></p>
                            {% for field in new_row_columns %}
                                {% if field != 'id' %}
                                    <p class="text-input-title">{{field}}</p>
                                    <input class="text-input" type="text" name="{{field}}" placeholder="{{field}}"><br>
                                {% endif %}
                            {% endfor %}
                            <input class="input-button" type="submit" name="submitSave" value="SAVE">
                        </form>
                    </center>
                {% else %}
                    {#================================= TABLES-BROWSER =================================#}
                    {% if table_name != null %}
                        <ul class="breadcrumb">
                            <li>
                                <a class="selector-button btn-small" href="/admin/database"><strong><i class="fa fa-arrow-left" aria-hidden="true"></i></strong></a>
                            </li>
                                <li> 
                                    <a class="selector-button btn-small" href="/admin/database/delete/1/{{table_name}}/all"><strong><i class="fa fa-trash" aria-hidden="true"></i> {{table_name}}</strong></a>
                                </li>
                            <li>    
                            <a class="selector-button btn-small" href="/admin/database/add/{{page}}/{{table_name}}"><strong>NEW</strong></a>
                        </li>
                            <li class="count-text-in-menuR">{{table_name}} = {{table_data_count_all}} rows</li>
                        </ul>
                        {% if table_data_count == 0 %}
                            <h2 class="page-title">table: '{{table_name}}' is empty</h2>
                        {% else %}
                            <div class="table-responsive">
                                <table class="table table-dark">
                                    <thead>
                                        <tr class="line-item">  
                                            {% for column in table_columns %}
                                                <th scope='col'>{{column}}</th>
                                            {% endfor %}
                                            <th cope='col'>Edit</th>
                                            <th cope='col'>X</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for row in table_data %}
                                            <tr class="line-item">
                                                {% for column in table_columns %}
                                                    <th scope='row'>
                                                        {% set content = row[column] | slice(0, 200) %}
                                                        {{ content ~ (row[column] | length > 200 ? '...' : '') }}
                                                    </th>
                                                {% endfor %}
                                                <td><a class="text-warning delete-link-todos" href="/admin/database/edit/{{page}}/{{table_name}}/{{row.id}}">Edit</a></td>
                                                <td><a class="delete-link-todos" href="/admin/database/delete/{{page}}/{{table_name}}/{{row.id}}">X</a></td>
                                            </tr>
                                        {% endfor %} 
                                    </tbody>
                                </table>
                            </div>
                            <div class="page-button-box">
                                {% if page != 1 %}
                                    <a class="back-page-button" href="/admin/database/{{table_name}}/{{page - 1}}">Back</a>
                                {% endif %}
                                {% if limit == table_data_count %}
                                    <a class="back-page-button" href="/admin/database/{{table_name}}/{{page + 1}}">Next</a>
                                {% endif %}
                            </div>
                            {% if page != 1 or limit == table_data_count %}
                                <br>
                            {% endif %}
                        {% endif %}
                    {% endif %}
                {% endif %}
            {% endif %}
        {% endif %}
    {% endif %}
</div>
{% endblock %}
